To fix the 404 error and the Certificate configuration while ensuring the .225 IP is correctly mapped to your Ingress, use the following sequence of commands.

I have cleaned up your steps to ensure they execute in the correct order and include the missing ingressClassName fix.

1. Install Cert-Manager
Bash

kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
2. Create ClusterIssuer & Certificate
Bash

# Create the Issuer
cat <<EOF | kubectl apply -f -
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: awx-selfsigned-issuer
spec:
  selfSigned: {}
EOF

# Create the Certificate in the awx namespace
cat <<EOF | kubectl apply -n awx -f -
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: awx-server-cert
spec:
  secretName: awx-server-tls-secret
  dnsNames:
    - awx-server-01.vgs.com
  issuerRef:
    name: awx-selfsigned-issuer
    kind: ClusterIssuer
    group: cert-manager.io
EOF
3. Configure Networking (.225 IP Move)
This moves the fixed IP from the AWX backend service to the NGINX Ingress Controller.

Bash

# 1. Make AWX service internal only
kubectl patch svc awx-prod-service -n awx -p '{"spec":{"type":"ClusterIP","loadBalancerIP":null}}'

# 2. Assign the .225 IP to the NGINX Ingress Controller
kubectl patch svc ingress-nginx-controller -n ingress-nginx -p '{"spec":{"type":"LoadBalancer","loadBalancerIP":"192.168.253.225"}}'

# 3. Force MetalLB to use the correct pool for Ingress
kubectl annotate svc ingress-nginx-controller -n ingress-nginx metallb.io/address-pool=awx-fixed-ip --overwrite
4. Update AWX Instance & Fix 404
This ensures the AWX Operator knows to use the nginx class (fixing the 404) and the TLS secret.

Bash

cat <<EOF | kubectl apply -n awx -f -
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx-prod
spec:
  service_type: ClusterIP
  ingress_type: ingress
  ingress_class_name: nginx
  hostname: awx-server-01.vgs.com
  ingress_tls_secret: awx-server-tls-secret
  admin_password_secret: awx-admin-password
  postgres_storage_class: longhorn
EOF

# Manual override fix for the Ingress Class (just in case)
kubectl patch ingress awx-prod-ingress -n awx -p '{"spec":{"ingressClassName":"nginx"}}'
5. Final Verification
Wait 30 seconds for the Ingress to reload, then run:

Bash

curl -vk https://awx-server-01.vgs.com/

kubectl patch svc longhorn-frontend -n longhorn-system -p '{"spec": {"type": "LoadBalancer"}}'

kubectl get svc longhorn-frontend -n longhorn-system
