kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "task_resource_requirements": {
      "requests": {
        "cpu": "1",
        "memory": "2Gi"
      },
      "limits": {
        "cpu": "2",
        "memory": "3Gi"
      }
    }
  }
}'


kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "web_resource_requirements": {
      "requests": {
        "cpu": "250m",
        "memory": "512Mi"
      },
      "limits": {
        "cpu": "500m",
        "memory": "1Gi"
      }
    }
  }
}'


kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "projects_persistence": true
  }
}'


kubectl patch awx awx-server -n awx --type=merge -p '{
   "spec": {
     "projects_storage_access_mode": "ReadWriteOnce"
   }
 }'


kubectl delete pvc awx-server-projects-claim -n awx
kubectl get pvc -n awx -w


kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "projects": [
      {
        "name": "ANSIBLE",
        "scm_type": "git",
        "scm_url": "https://github.com/Vignesh-8419/ANSIBLE",
        "scm_branch": "main",
        "scm_clean": true,
        "scm_delete_on_update": true,
        "scm_update_on_launch": true,
        "scm_depth": 1
      }
    ],
    "projects_persistence": true
  }
}'


kubectl -n awx edit awx awx-server


task_resource_requirements:
  requests:
    cpu: "1"
    memory: 2Gi
  limits:
    cpu: "2"
    memory: 4Gi

web_resource_requirements:
  requests:
    cpu: 250m
    memory: 2Gi
  limits:
    cpu: 500m
    memory: 4Gi
kubectl -n awx get awx awx-server -o yaml


kubectl -n awx delete pod --all


  init_container_resource_requirements:
    requests:
      memory: "1Gi"
      cpu: "200m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  
  postgres_resource_requirements:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  ee_resource_requirements:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

kubectl -n awx describe pod awx-server-web | grep -A5 Limits
kubectl -n awx describe pod awx-server-task | grep -A5 Limits


kubectl -n awx get pod -o wide


dmesg -T | grep -i oom

systemctl restart k3s

vi awx-instance.yaml

apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx-server
  namespace: awx
spec:
  service_type: ClusterIP
  ingress_type: ingress
  hostname: ansible-server-01.vgs.com
  ingress_tls_secret: awx-server-tls
  # Add the following lines:
  ingress_annotations: |
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"

kubectl apply -f awx-instance.yaml -n awx


openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=ansible-server-01.vgs.com"

kubectl create secret tls awx-server-tls \
  --cert=tls.crt \
  --key=tls.key \
  -n awx

kubectl delete ingress awx-ingress -n awx

kubectl delete statefulset awx-server-postgres-15 -n awx --cascade=orphan
kubectl logs -f deployment/awx-operator-controller-manager -n awx --all-containers
kubectl get ingress -n awx
kubectl delete statefulset awx-server-postgres-15 -n awx --cascade=orphan
kubectl delete ingress awx-ingress -n awx --ignore-not-found
kubectl rollout restart deployment awx-operator-controller-manager -n awx
kubectl get ingress -n awx

firewall-cmd --permanent --zone=trusted --add-source=10.42.0.0/16

firewall-cmd --permanent --zone=trusted --add-source=10.43.0.0/16 # Services

firewall-cmd --reload
