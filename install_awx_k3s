kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "task_resource_requirements": {
      "requests": {
        "cpu": "1",
        "memory": "2Gi"
      },
      "limits": {
        "cpu": "2",
        "memory": "3Gi"
      }
    }
  }
}'


kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "web_resource_requirements": {
      "requests": {
        "cpu": "250m",
        "memory": "512Mi"
      },
      "limits": {
        "cpu": "500m",
        "memory": "1Gi"
      }
    }
  }
}'


kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "projects_persistence": true
  }
}'


kubectl patch awx awx-server -n awx --type=merge -p '{
   "spec": {
     "projects_storage_access_mode": "ReadWriteOnce"
   }
 }'


kubectl delete pvc awx-server-projects-claim -n awx
kubectl get pvc -n awx -w


kubectl patch awx awx-server -n awx --type=merge -p '{
  "spec": {
    "projects": [
      {
        "name": "ANSIBLE",
        "scm_type": "git",
        "scm_url": "https://github.com/Vignesh-8419/ANSIBLE",
        "scm_branch": "main",
        "scm_clean": true,
        "scm_delete_on_update": true,
        "scm_update_on_launch": true,
        "scm_depth": 1
      }
    ],
    "projects_persistence": true
  }
}'


kubectl -n awx edit awx awx-server


task_resource_requirements:
  requests:
    cpu: "1"
    memory: 2Gi
  limits:
    cpu: "2"
    memory: 4Gi

web_resource_requirements:
  requests:
    cpu: 250m
    memory: 2Gi
  limits:
    cpu: 500m
    memory: 4Gi
kubectl -n awx get awx awx-server -o yaml


kubectl -n awx delete pod --all


  init_container_resource_requirements:
    requests:
      memory: "1Gi"
      cpu: "200m"
    limits:
      memory: "2Gi"
      cpu: "500m"
  
  postgres_resource_requirements:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  ee_resource_requirements:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

kubectl -n awx describe pod awx-server-web | grep -A5 Limits
kubectl -n awx describe pod awx-server-task | grep -A5 Limits


kubectl -n awx get pod -o wide


dmesg -T | grep -i oom

systemctl restart k3s

cat <<EOF | kubectl apply -f -
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: force-https
  namespace: awx
spec:
  redirectScheme:
    scheme: https
    permanent: true
EOF


HTTP == HTTPS

openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=ansible-server-01.vgs.com"

# 1. Re-create the Middleware with a clean name
cat <<EOF | kubectl apply -f -
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: force-https
  namespace: awx
spec:
  redirectScheme:
    scheme: https
    permanent: true
EOF

# 2. Apply the AWX Instance with the EXACT naming string Traefik requires
# In K3s Traefik, the format is: namespace-name@kubernetescrd
cat <<EOF > awx-instance.yaml
apiVersion: awx.ansible.com/v1beta1
kind: AWX
metadata:
  name: awx-server
  namespace: awx
spec:
  service_type: ClusterIP
  ingress_type: ingress
  hostname: ansible-server-01.vgs.com
  ingress_tls_secret: awx-server-tls
  ingress_annotations: |
    traefik.ingress.kubernetes.io/router.middlewares: awx-force-https@kubernetescrd
  extra_settings:
    - setting: SECURE_PROXY_SSL_HEADER
      value: "('HTTP_X_FORWARDED_PROTO', 'https')"
EOF

# 3. Apply the configuration
kubectl apply -f awx-instance.yaml -n awx

# 4. Force a clean refresh of the Ingress
kubectl delete ingress awx-server-ingress -n awx --ignore-not-found

# 5. Wait for the Operator to recreate the Ingress and Traefik to load it
echo "Waiting 30s for the front-door to refresh..."
sleep 30

# 6. VERIFICATION TESTS (Targeting the external IP to avoid 'Connection Refused')
echo "--- Testing Redirect (Should return 301/302) ---"
curl -I -L http://ansible-server-01.vgs.com

echo "--- Testing HTTPS (Should return 200) ---"
curl -I -k https://ansible-server-01.vgs.com

# 7. Credentials
echo "--- Login Info ---"
echo "URL: https://ansible-server-01.vgs.com"
echo "User: admin"
echo -n "Pass: "
kubectl get secret awx-server-admin-password -n awx -o jsonpath="{.data.password}" | base64 --decode; echo
