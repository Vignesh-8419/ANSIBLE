cat <<EOF | kubectl apply -f -
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: awx-static-pool
  namespace: metallb-system
spec:
  addresses:
  - 192.168.253.221-192.168.253.224
  - 192.168.253.226-192.168.253.230
---
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: longhorn-ip-pool
  namespace: metallb-system
spec:
  addresses:
  - 192.168.253.220/32
---
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: awx-combined-adv
  namespace: metallb-system
spec:
  ipAddressPools: [awx-static-pool, longhorn-ip-pool]
EOF

# Annotate Longhorn frontend service to use dedicated IP pool
kubectl annotate svc longhorn-frontend -n longhorn-system metallb.universe.tf/address-pool=longhorn-ip-pool --overwrite

# Restart MetalLB controller to force IP reassignment
kubectl rollout restart deployment controller -n metallb-system

# Watch Longhorn service until it gets the external IP
kubectl get svc longhorn-frontend -n longhorn-system -w
